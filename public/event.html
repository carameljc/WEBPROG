<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Event Gereja</title>
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
    <header>
        <nav>
            <div class="nav-brand">LOGO</div>
            <div class="nav-links">
                <a href="/index.html">Beranda</a>
                <a href="/tentang.html">Tentang Kami</a>
                <a href="/jadwal.html">Jadwal & Kegiatan</a>
                <a href="/galeri.html">Galeri</a>
                <a href="/persembahan.html">Persembahan</a>
                <a href="/kontak.html">Kontak</a>

                <a href="/eventAdmin.html" class="admin-only">Manajemen Event</a>
                <a href="/jemaat.html" class="admin-only">Manajemen Jemaat</a>
                <a href="/galleryAdmin.html" class="admin-only">Manajemen Galeri</a>
                
                <a href="/event.html" class="jemaat-only">Event</a>
            </div>
            <div class="nav-user">
                <a href="/login.html" id="login-link" class="nav-button">Login</a>
                <div id="user-info"><button id="logout-btn" class="nav-button">Logout</button></div>
            </div>
        </nav>
    </header>

    <main class="container">
        <h1>üìÖ Daftar Event Gereja</h1>
        <hr style="margin-bottom: 2rem;">
        
        <section id="daftar-event-container">
            <div id="eventList" class="event-list">
                <p>Sedang memuat event...</p>
            </div>
        </section>

    </main>

 <script>
    // SCRIPT UNTUK MENGAMBIL DAN MENAMPILKAN DATA EVENT
    document.addEventListener("DOMContentLoaded", () => {
        const eventList = document.getElementById("eventList");

        // FUNGSI UTAMA UNTUK MEMUAT EVENT
        async function loadEvents() {
            try {
                // PERBAIKAN 1: Gunakan URL API LENGKAP yang benar
                const response = await fetch("/api/event/daftar"); 
                
                // Pastikan respons berhasil diterima
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                
                const result = await response.json();

                // PERBAIKAN 2: Cek properti 'success' dan ambil array dari 'data'
                if (!result.success) {
                    throw new Error(result.message || "Gagal mengambil data dari server.");
                }

                const events = result.data; // Ambil array data event

                eventList.innerHTML = ""; // Bersihkan pesan 'Memuat...'

                if (events.length === 0) {
                    eventList.innerHTML = "<p>Belum ada event yang ditambahkan saat ini.</p>";
                    return;
                }

                // Jika data ditemukan
                let eventHTML = '';
                events.forEach((event) => {
                    eventHTML += `
                        <div class="event-card">
                            <h3>${event.nama_event}</h3>
                            <img src="/uploads/${event.poster}" alt="${event.nama_event}" 
                                style="max-width:100%; border-radius:10px; margin-top:10px; object-fit: cover;">
                            <p><a href="${event.link_gform}" target="_blank" class="btn-daftar">üìù Daftar Event</a></p>
                        </div>
                    `;
                });
                eventList.innerHTML = eventHTML;

            } catch (err) {
                // Penanganan Error (Jaringan atau Logika Server)
                console.error("Gagal memuat data event:", err);
                // Menampilkan pesan error yang diminta
                eventList.innerHTML = "<p style='color: #721c24;'>Gagal memuat event. Silakan coba lagi nanti.</p>";
            }
        }

        loadEvents(); // Panggil fungsi saat DOM selesai dimuat
    });
</script>
    
    <script src="/js/main.js"></script>
</body>
</html>
